htUA = {
    "iPod:3.0" : {
        ua : "Mozilla/5.0 (iPod; U; CPU iPhone OS 3_0 like Mac OS X;ko-kr)AppleWebKit/528.18(KHTML, like Gecko)Version/4.0 Mobile/7A341 Safari/528.16",
        useCss3d : true,
        useFixed : false,
        useTimingFunction : true,
        iphone: true,
        name: "iphone",
        version: "3.0"
    },

    "iPhone4:4.3.3" : {
        ua : "Mozilla/5.0 (iPhone;U;CPU iPhone OS 4_3_3 like Max OS X;ko-kr) AppleWebKit/533.17.9(KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5",
        useCss3d : true,
        useFixed : false,
        useTimingFunction : true,
        iphone: true,
        name: "iphone",
        version: "4.3.3"
    },
    "iPad:4.2.1" : {
        ua : "Mozilla/5.0 (iPad;U;CPU OS 4_2_1 like Mac OS X;ko-kr) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5",
        useCss3d : true,
        useFixed : false,
        useTimingFunction : true,
        ipad: true,
        name: "ipad",
        version: "4.2.1"
    },
    "iPad2:4.3.3" : {
        ua : "Mozilla/5.0 (iPad; U; CPU OS 4_3_3 like Mac OS X;ko-kr)AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8J2 Safari/6533.18.5",
        useCss3d : true,
        useFixed : false,
        useTimingFunction : true,
        ipad: true,
        name: "ipad",
        version: "4.3.3"
    },
    "iPhone4:5.0.1" : {
        ua : "Mozilla/5.0 (iPhone;CPU iPhone OS 5_0_1 like Mac OS X) AppleWebKit/534.46 (KHTML, like Gecko) Version/5.1 Mobile/9A405 Safari/7534.48.3",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : true,
        iphone: true,
        name: "iphone",
        version: "5.0.1"
    },
    "iPhone5:6.0.2" : {
        ua : "Mozilla/5.0 (iPhone;CPU iPhone OS 6_0_2 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10A551 Safari/8536.25",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        iphone: true,
        name: "iphone",
        version: "6.0.2"
    },

    "iPhone4:6.1.2" : {
        ua : "Mozilla/5.0 (iPhone;CPU iPhone OS 6_1_2 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10B146 Safari/8536.25",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        iphone: true,
        name: "iphone",
        version: "6.1.2"
    },

    "iPhone4:7.0" : {
        ua : "Mozilla/5.0 (iPhone;CPU iPhone OS 7_0 like Mac OS X) AppleWebKit/536.26 (KHTML, like Gecko) Version/6.0 Mobile/10B146 Safari/8536.25",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        iphone: true,
        name: "iphone",
        version: "7.0"
    },

    "GalaxyS:2.1" : {
        ua : "Mozilla/5.0 (Linux;U;Android 2.1;ko-kr;SHW-M110S Build/ÉCLAIR) AppleWebKit/530.17 (KHTML, like Gecko) Version/4.0 Mobile Safari/530.17",
        useCss3d : false,
        useFixed : false,
        useTimingFunction : false,
        android: true,
        galaxyS: true,
        hasOffsetBug : true,
        name: "galaxyS",
        samsung: true,
        version: "2.1"
    },
    "GalaxyS:2.2" : {
        ua : "Mozilla/5.0 (Linux;U;Android 2.2;ko-kr;SHW-M110S Build/FROYO) AppleWebKit/533.1(KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
        useCss3d : false,
        useFixed : false,
        useTimingFunction : false,
        android: true,
        galaxyS: true,
        name: "galaxyS",
        hasOffsetBug : true,
        samsung: true,
        version: "2.2"
    },
    "GalaxyS:2.3.4" : {
        ua : "Mozilla/5.0 (Linux;U;Android 2.3.4;ko-kr;SHW-M110S Build/GINGERBREAD)AppleWebKit/533.1(KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
        useCss3d : false,
        useFixed : false,
        useTimingFunction : false,
        android: true,
        galaxyS: true,
        name: "galaxyS",
        hasOffsetBug : true,
        samsung: true,
        version: "2.3.4"
    },
    "GalaxyS2:2.3.3" : {
        ua : "Mozilla/5.0 (Linux;U;Android 2.3.3;ko-kr;SHW-M250S Build/GINGERBREAD) AppleWebKit/533.1(KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
        useCss3d : false,
        useFixed : false,
        useTimingFunction : false,
        hasOffsetBug : true,
        android: true,
        galaxyS2: true,
        name: "galaxyS2",
        samsung: true,
        version: "2.3.3"
    },
    "GalaxyNote:2.3.6" : {
        ua : "Mozilla/5.0 (Linux;U;Android 2.3.6;ko-kr;SHV-E160S Build/GINGERBREAD) AppleWebKit/533.1 (KHTML, like Gecko) Version/4.0 Mobile Safari/533.1",
        useCss3d : false,
        useFixed : false,
        useTimingFunction : false,
        hasOffsetBug : true,
        android: true,
        galaxyNote: true,
        name: "galaxyNote",
        samsung: true,
        version: "2.3.6"
    },
    "GalaxyTab2:3.1" : {
        ua : "Mozilla/5.0 (Linux;U; Android 3.1;ko-kr;SHW-M380S Build/HMJ37) AppleWebkit/534.13(KHTML, like Gecko) Version/4.0 Safari/534.13",
        useCss3d : false,
        useFixed : true,
        useTimingFunction : false,
        hasOffsetBug : true,
        android: true,
        galaxyTab2: true,
        name: "galaxyTab2",
        samsung: true,
        version: "3.1"
    },
    "GalaxyNexus:4.0.1" : {
        ua : "Mozilla/5.0 (Linux;U;Android 4.0.1;ko-kr;Galaxy Nexus Build/ITL41F)AppleWebKit/534.30 (KHTML, like Gecko)Version/4.0 Mobile Safari/534.30",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        galaxyNexus: true,
        name: "galaxyNexus",
        samsung: true,
        version: "4.0.1"
    },
    "GalaxyS3:4.0.4" : {
        ua : "Mozilla/5.0 (Linux; U; Android 4.0.4; ko-kr; SHV-E210S Build/IMM76D) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        useCss3d_isLong : true,
        android: true,
        galaxyS3: true,
        name: "galaxyS3",
        samsung: true,
        version: "4.0.4"
    },
    "GalaxyS2:chrome" : {
        ua : "Mozilla/5.0 (Linux; U;Android 4.0.3;ko-kr; SHW-M250S Build/IML74K) AppleWebKit/535.7 (KHTML, like Gecko) Chrome/16.0.912.77 Mobile Safari/535.7",
        useCss3d : false,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        bChrome: true,
        hasKitkatHighlightBug : true,
        galaxyS2: true,
        name: "galaxyS2",
        samsung: true,
        version: "4.0.3"
    },
    "GalaxyS4:4.2.2" : {
        ua : "Mozilla/5.0 (Linux; Android 4.2.2; ko-kr; SAMSUNG SHV-E300S Build/JDQ39) AppleWebKit/535.19 (KHTML, like Gecko) Version/1.0 Chrome/18.0.1025.308 Mobile Safari/535.19",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        bChrome: true,
        bSBrowser: true,
        galaxyS4: true,
        name: "galaxyS4",
        samsung: true,
        version: "4.2.2"
    },
    "GalaxyS4:chrome" : {
        ua : "Mozilla/5.0 (Linux; Android 4.2.2; SHV-E300S Build/JDQ39) AppleWebKit/535.19 (KHTML, like Gecko) Chrome/18.0.1025.166 Mobile Safari/535.19",
        useCss3d : false,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        bChrome: true,
        hasKitkatHighlightBug : true,
        galaxyS4: true,
        name: "galaxyS4",
        samsung: true,
        version: "4.2.2"
    },
    "GalaxyNexus:4.2.2" : {
        ua : "Mozilla/5.0 (Linux; Android 4.2.2;ko-kr; Galaxy Nexus Build/JDQ39) AppleWebKit/534.30 (KHTML, like Gecko) Version/4.0 Mobile Safari/534.30",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        galaxyNexus: true,
        name: "galaxyNexus",
        samsung: true,
        version: "4.2.2"
    },
    "GalaxyNexus:chrome25" : {
        ua : "Mozilla/5.0 (Linux; Android 4.2.2; Galaxy Nexus Build/JDQ39) AppleWebKit/537.22 (KHTML, like Gecko) Chrome/18.0.1364.169 Mobile Safari/537.22",
        useCss3d : false,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        bChrome: true,
        hasKitkatHighlightBug : true,
        galaxyNexus: true,
        name: "galaxyNexus",
        samsung: true,
        version: "4.2.2"
    },
    "GalaxyNexus:chrome25over" : {
        ua : "Mozilla/5.0 (Linux; Android 4.2.2; Galaxy Nexus Build/JDQ39) AppleWebKit/537.22 (KHTML, like Gecko) Chrome/25.0.1364.169 Mobile Safari/537.22",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        bChrome: true,
        hasKitkatHighlightBug : true,
        galaxyNexus: true,
        name: "galaxyNexus",
        samsung: true,
        version: "4.2.2"
    },
    "GalaxyNote2:chrome25over" : {
        ua : "Mozilla/5.0 (Linux; Android 4.3; SHV-E250S Build/JSS15J) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.59 Mobile Safari/537.36",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        bChrome: true,
        name: "galaxyNote2",
        hasKitkatHighlightBug : true,
        galaxyNote2 : true,
        samsung: true,
        version: "4.3"
    },
    "Xiaomi_2013061_TD:browser" : {
        ua : "Xiaomi_2013061_TD/V1 Linux/3.4.5 Android/4.2.1 Release/09.18.2013 Browser/AppleWebKit534.30 Mobile Safari/534.30 MBBMS/2.2 System/Android 4.2.1 XiaoMi/MiuiBrowser/1.0",
        useCss3d : true,
        useFixed : true,
        useTimingFunction : false,
        android: true,
        bChrome: false,
        name: "android",    // 아무런 정보도 나오지 않을경우, android or ipad or iphone
        galaxyNote2 : false,
        samsung: false,
        version: "4.2.1"
    }
};

/** Module의 setup과 teardown은 각 테스트 마다 호출됨 */
module("Test Template", {
    setup: function() {
        /** 객체 생성 */

    },
    teardown : function() {
        /** 객체 소멸 */
    }
} );

test("jindo.m namesapce 확인", function() {
    equal( new Boolean(jindo.m && window.jindo.m) , true, "jindo namespace 존재");
});

test("properties", function() {
    var htUserAgent = "";
    var ht = null;
    for(var key in htUA) {
        htUserAgent = htUA[key];
        navigator = { userAgent : htUserAgent.ua };
        jindo.$Agent()._navigator = navigator;
        jindo.m.$init();
        // jindo.m.patch();
        ht = jindo.m.getDeviceInfo();
        for(var i in ht) {
            if(typeof htUserAgent[i] === "undefined") {
                htUserAgent[i] =  false;
            }
        }
        equal(htUserAgent.useCss3d ,                jindo.m.useCss3d()                          ,key);
        equal(htUserAgent.useFixed ,                jindo.m.useFixed()                          ,key);
        equal(htUserAgent.useTimingFunction ,jindo.m.useTimingFunction()            ,key);
    }
});

// deprecated
test("deviceInfo", function() {
    var htUserAgent = "";
    var ht = null;
    for(var key in htUA) {
        htUserAgent = htUA[key];
        navigator = { userAgent : htUserAgent.ua };
        jindo.$Agent()._navigator = navigator;
        jindo.m.$init();
        // jindo.m.patch();
        ht = jindo.m.getDeviceInfo();
        for(var i in ht) {
            if(typeof htUserAgent[i] === "undefined") {
                htUserAgent[i] =  false;
            }
        }
        equal(htUserAgent.useCss3d ,                jindo.m.useCss3d()                          ,key);
        equal(htUserAgent.useFixed ,                jindo.m.useFixed()                          ,key);
        equal(htUserAgent.useTimingFunction ,jindo.m.useTimingFunction()            ,key);
        equal(htUserAgent.android,                      ht.android                          ,key);
        equal(htUserAgent.bChrome,                      ht.bChrome                          ,key);
        equal(htUserAgent.bInapp,                   ht.bInapp                               ,key);
        equal(htUserAgent.bSBrowser,                ht.bSBrowser                        ,key);
        equal(htUserAgent.galaxyNexus,          ht.galaxyNexus                  ,key);
        equal(htUserAgent.galaxyNote,           ht.galaxyNote                       ,key);
        equal(htUserAgent.galaxyNote2,          ht.galaxyNote2                  ,key);
        equal(htUserAgent.galaxyS,                      ht.galaxyS                          ,key);
        equal(htUserAgent.galaxyS2,                 ht.galaxyS2                         ,key);
        equal(htUserAgent.galaxyS2LTE,          ht.galaxyS2LTE                  ,key);
        equal(htUserAgent.galaxyS3,                 ht.galaxyS3                         ,key);
        equal(htUserAgent.galaxyS4,                 ht.galaxyS4                         ,key);
        equal(htUserAgent.galaxyTab,                ht.galaxyTab                        ,key);
        equal(htUserAgent.galaxyTab2,           ht.galaxyTab2                       ,key);
        equal(htUserAgent.ipad,                         ht.ipad                                 ,key);
        equal(htUserAgent.iphone,                   ht.iphone                               ,key);
        equal(htUserAgent.lg,                           ht.lg                                       ,key);
        equal(htUserAgent.name,                             ht.name                                 ,key);
        equal(htUserAgent.optimusLte,           ht.optimusLte                       ,key);
        equal(htUserAgent.optimusLte2,          ht.optimusLte2                  ,key);
        equal(htUserAgent.optimusVu,                ht.optimusVu                        ,key);
        equal(htUserAgent.samsung,                   ht.samsung                          ,key);
        equal(htUserAgent.version,                  ht.version                          ,key);
        equal(htUserAgent.win,                              ht.win                                  ,key);
    }
});

test("getOsInfo", function() {
    var htUserAgent = "";
    var ht = null;
    for(var key in htUA) {
        htUserAgent = htUA[key];
        navigator = { userAgent : htUserAgent.ua };
        jindo.$Agent()._navigator = navigator;
        jindo.m.$init();
        // jindo.m.patch();
        ht = jindo.m.getOsInfo();
        for(var i in ht) {
            if(typeof htUserAgent[i] === "undefined") {
                htUserAgent[i] =  false;
            }
        }
        equal(htUserAgent.android,                  ht.android                          ,key);
        equal(htUserAgent.bInapp,                   ht.bInapp                               ,key);
        equal(htUserAgent.ipad,                         ht.ipad                                 ,key);
        equal(htUserAgent.iphone,                   ht.iphone                               ,key);
        equal(htUserAgent.version,                  ht.version                          ,key);
    }
});


test("getBrowserInfo", function() {
    var htUserAgent = "";
    var ht = null;
    for(var key in htUA) {
        htUserAgent = htUA[key];
        navigator = { userAgent : htUserAgent.ua };
        jindo.$Agent()._navigator = navigator;
        jindo.m.$init();
        // jindo.m.patch();
        ht = jindo.m.getBrowserInfo();
        for(var i in ht) {
            if(typeof htUserAgent[i] === "undefined") {
                htUserAgent[i] =  false;
            }
        }
        equal(htUserAgent.bChrome,                      ht.chrome                          ,key);
        equal(htUserAgent.bSBrowser,                ht.bSBrowser                        ,key);
        
        // http://gitlab.jindo.nhncorp.com/sculove/jindo-mobile-component/issues/48
        if(typeof htUserAgent.hasKitkatHighlightBug == "undefined") {
        	htUserAgent.hasKitkatHighlightBug = false;
        }
	  equal(htUserAgent.hasKitkatHighlightBug,               jindo.m._hasKitkatHighlightBug()                       ,key + " 킷켓 하이라이트 여부 확인");
    }
});

test("getCssPrefix", function() {
    var sCssPrefix = jindo.m.getCssPrefix();
    if(typeof document.body.style.MozTransition !== "undefined") {
        equal(sCssPrefix,"Moz", "모질라..");
    } else if(typeof document.body.style.webkitTransition !== "undefined") {
        equal(sCssPrefix,"webkit", "웹킷 계열..");
    } else if(typeof document.body.style.OTransition !== "undefined") {
        equal(sCssPrefix,"O", "오페라..");
    } else {
        equal(sCssPrefix,"", "그외는 prefix가 없음");
    }
});

test("attachTransitionEnd / detachTransitionEnd, getCssOffset", function() {
    var wel = jindo.$Element("layer");
    var ele = wel.$value();
    var sCssPrefix = jindo.m.getCssPrefix();
    var isEnd = false;
    var fn = function(we) {
        isEnd = true;
        htCssOffset = jindo.m.getCssOffset(ele);
        equal(htCssOffset.left , 50, "왼쪽 이동후 50");
        equal(htCssOffset.top , 50, "위쪽 이동후 50");
        jindo.m.detachTransitionEnd(ele,fn);
        start();
    };
    var htCssOffset = jindo.m.getCssOffset(ele);
    jindo.m.attachTransitionEnd(ele,fn);
    equal(htCssOffset.left , 0, "왼쪽 초기 0");
    equal(htCssOffset.top , 0, "위쪽 초기 0");
    equal(isEnd, false, "초기 TransitionEnd는 false");
    wel.css(sCssPrefix + "TransitionProperty", "-webkit-transform")
        .css(sCssPrefix + "TransitionDuration", "1000ms")
        .css(sCssPrefix + "Transform", "translate(50px,50px)");
    stop();
});

// http://gitlab.jindo.nhncorp.com/sculove/jindo-mobile-component/issues/1
test("hasOffsetBug의 patch 적용이 안되는 버그", function() {
     jindo.m.patch(sVersion).add({
        "hasOffsetBug" : function() {
            return 0;
        }
    });
    var htUserAgent = "";
    var ht = null;
    for(var key in htUA) {
        htUserAgent = htUA[key];
        navigator = { userAgent : htUserAgent.ua };
        jindo.$Agent()._navigator = navigator;
        jindo.m.$init();
        if(typeof htUserAgent.hasOffsetBug == "undefined") {
            htUserAgent.hasOffsetBug = false;
        }
        equal(htUserAgent.hasOffsetBug,  jindo.m.hasOffsetBug(),key);
    }

    var sVersion = jindo.m.Component.VERSION;
    jindo.m.patch(sVersion).add({
        "hasOffsetBug" : function() {
            return -1;
        }
    });
    equal(jindo.m.hasOffsetBug() , false, "모두 false");

    jindo.m.patch(sVersion).add({
        "hasOffsetBug" : function() {
            return 1;
        }
    });
    equal(jindo.m.hasOffsetBug() , true, "모두 true");
});


// http://gitlab.jindo.nhncorp.com/sculove/jindo-mobile-component/issues/48
test("kitkat 하이라이트 이슈 제거를 위한 style 확인", function() {
	var el = jindo.$(jindo.m.KITKAT_HIGHLIGHT_ID);
	var oSheet = el.sheet || el.styleSheet;
				
	equal(oSheet.rules.length,2, "2개의 스타일 룰이 포함되어 있다");
	ok(oSheet.rules[0].cssText.indexOf('.' + jindo.m.KITKAT_HIGHLIGHT_CLASS + ' * {') != -1, "css rule1이 존재하는가?");
	ok(oSheet.rules[1].cssText.indexOf('.' + jindo.m.KITKAT_HIGHLIGHT_CLASS + ' {') != -1, "css rule2이 존재하는가?");
	
});